// Assisted by WCA@IBM
// Latest GenAI contribution: ibm/granite-20b-code-instruct-v2
<!DOCTYPE html>
<html>
  <head>
    <title>GenAI with Sales Manuals Demo Page</title>
  </head>
  <body>
    <h1>GenAI with Sales Manuals Demo Page</h1>
    <h2>Introduction</h2>
    <p>This is a simple Flask web page, which is built to link to the different stages of the demo David Spurway built to show GenAI using Sales Manual PDF documents, running on Red Hat OpenShift Container Platform on IBM Power.</p> 
    <p>For this, we are using the Techzone environment "OpenShift on POWER10 - Bastion, 1 Master with NFS Storage".</p>

    <h2>List Collections which can be used for Retrieval Augmented Generation at this time</h2>
    <button onclick="myRAG_list_collections_func()">Click to List Collections for RAG</button>
    <p id="RAG_list_collections_id"></p>

    <script>
      function myRAG_list_collections_func() {
        fetch("https://rag-list-collections-llm-on-techzone.apps.p1296.cecc.ihost.com/")
          .then(response => response.json())
          .then(data => {
            console.log(data);
            document
                .getElementById("RAG_list_collections_id")
                .insertAdjacentHTML("beforeend", `<p>${data.result}</p>`);
            })
          .catch(error => {
            console.error("Error fetching data:", error);
          });
      }
    </script>

    <h2>Drop the Collections from the Vector DB, so we can load fresh data to be used for Retrieval Augmented Generation</h2>
    <div>
    <label for="collection">Collection Name:</label>
    <input type="text" id="collection" name="collection"><br><br>
    </div>
    <button onclick="myRAG_drop_collections_func()">Enter a collection above then click to drop that collection</button>
    <p id="RAG_drop_collections_id"></p>

    <script>
      function myRAG_drop_collections_func() {
        var collectionName = document.getElementById("collection").value;
        fetch("https://rag-drop-collection-llm-on-techzone.apps.p1296.cecc.ihost.com/?Collection=" + collectionName)
          .then(response => response.json())
          .then(data => {
            console.log(data);
            document
              .getElementById("RAG_drop_collections_id")
              .insertAdjacentHTML("beforeend", `<p>${data.result}</p>`);
          })
          .catch(error => {
            console.error("Error fetching data:", error);
          });
      }
    </script>

    <h2>Load pre-saved Sales Manual PDF documents into the Vector DB so the data to be used for Retrieval Augmented Generation</h2>
    <div>
      <button id="IBM_Power_S1012" onclick="myRAG_loader_func('IBM_Power_S1012')">Load IBM Power S1012 Sales Manual</button>
      <button id="IBM_Power_S1014" onclick="myRAG_loader_func('IBM_Power_S1014')">Load IBM IBM Power S1014 Sales Manual</button>
      <button id="IBM_Power_S1022" onclick="myRAG_loader_func('IBM_Power_S1022')">Load IBM IBM Power S1022 Sales Manual</button>
      <button id="IBM_Power_S1022s" onclick="myRAG_loader_func('IBM_Power_S1022s')">Load IBM IBM Power S1022s Sales Manual</button>
      <button id="IBM_Power_S1024" onclick="myRAG_loader_func('IBM_Power_S1024')">Load IBM IBM Power S1024 Sales Manual</button>
    </div>
    
    <p id="RAG_loader_server_name_id"></p>

    <script>
      function myRAG_loader_func(Server_Name) {
        document.getElementById(Server_Name).innerHTML = "Loading " + Server_Name + ".pdf. This takes a few minutes.";
        fetch("https://rag-loader-llm-on-techzone.apps.p1296.cecc.ihost.com/?Server_Name=" + Server_Name, { signal: AbortSignal.timeout(500000) })
          .then(response => response.json())
          .then(data => {
            console.log(data);
            document
              .getElementById("RAG_loader_id")
              .insertAdjacentHTML("beforeend", `<p>${data.result}</p>`);
            document.getElementById(Server_Name).innerHTML = "&#10003;";
          })
          .catch(error => {
            console.error("Error fetching data:", error);
          });
      }
    </script>

    <h2>Set Questions and Server Name and retrieve data from the Vector DB, so we can use is as part of our prompt for Retrieval Augmented Generation</h2>
    <p>Pick a Server Name to ask our questions about. We can then use the metadata saved with the Sales Manual information to get chunks only from the relivant Sales Manual that was stored.</p>
    <select id="Server_Name">
      <option value="IBM_Power_S1012">IBM Power S1012</option>
      <option value="IBM_Power_S1014">IBM Power S1014</option>
      <option value="IBM_Power_S1022">IBM Power S1022</option>
      <option value="IBM_Power_S1022s">IBM Power S1022s</option>
      <option value="IBM_Power_S1024">IBM Power S1024</option>
    </select>
    
    <div>
    <label for="Question1">Question 1:</label>
    <input type="text" id="Question1" name="Question1" value="How many dual-chip processor modules in the server?"><br>
    </div>
    <div>
    <label for="Question2">Question 2:</label>
    <input type="text" id="Question2" name="Question2" value="How Power10 processors in the server?"><br>
    </div>
    <div>
    <label for="Question3">Question 3:</label>
    <input type="text" id="Question3" name="Question3" value="What speed in GHz are the processors in the server?"><br>
    </div>
    <button onclick="myRAG_get_docs_func()">Pick a server from the list above, edit the questions if desired, then click to retrieve data to answer the questions</button><br><br>

    <p id="RAG_get_docs_id"></p>

    <script>
      function myRAG_get_docs_func() {
        var Server_Name = document.getElementById("Server_Name").value;
        var Question1 = document.getElementById("Question1").value;
        var Question2 = document.getElementById("Question2").value;
        var Question3 = document.getElementById("Question3").value;
        fetch("https://rag-get-docs-llm-on-techzone.apps.p1296.cecc.ihost.com/?Server_Name=" + Server_Name +"&Questions=\[\"" +Question1 +"\", \"" +Question2 +"\", \"" +Question3 +"\"\]")
          .then(response => response.json())
          .then(data => {
            console.log(data.result);
            console.log(data.docs);
            document
              .getElementById("RAG_get_docs_id")
              .insertAdjacentHTML("beforeend", `<p>${data.docs[0][0]{6}</p>`);
          })
          .catch(error => {
            console.error("Error fetching data:", error);
          });
      }
    </script>
    
  </body>
</html>
